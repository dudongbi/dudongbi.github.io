---
title: memo
date: 2022-12-26 16:44:09
tags: [assets,memo,gfw]
---

# assets

```bash
D:\zip\7z.exe a -tzip ../%~n0-%date:~2,2%%date:~5,2%%date:~8,2%-%time:~0,2%%time:~3,2%.zip ./* -xr!".git" -xr!node_modules -xr!dist -xr!android
```

[zip-upload.zip](/assets/zip-upload.zip)

[CompressiveSensing.cpp](/assets/CompressiveSensing.cpp)

[PartialFilter.cpp](/assets/PartialFilter.cpp)

[ec-100yo.html](/assets/ec-100yo.html)

[ec-wall.html](/assets/ec-wall.html)

[java-demo.zip](/assets/java-demo.zip)

[makedocx.py](/assets/makedocx.py)

[PortableCookpot_1202v3.zip](/assets/PortableCookpot_1202v3.zip)

[js-pets.html](/assets/js-pets.html)

# GFW

访问
<https://microsoftedge.microsoft.com/addons/detail/replace-google-cdn/cojepngjobmaiajphkijbdcdjnnjhpjc?hl=zh-CN>

node 仓库
`npm config set registry https://registry.npm.taobao.org`

git 下载
<https://npm.taobao.org/mirrors/git-for-windows/>

github 访问
`C:\Windows\System32\drivers\etc`
```ts
# https://github.com.ipaddress.com/github.com
140.82.112.3 github.com
# https://github.com.ipaddress.com/assets-cdn.github.com
140.82.112.3 assets-cdn.github.com
# https://www.ipaddress.com/site/fastly.net#ipinfo
# https://fastly.net.ipaddress.com/github.global.ssl.fastly.net
151.101.1.6   github.global.ssl.fastly.net
151.101.65.6  github.global.ssl.fastly.net
151.101.129.6 github.global.ssl.fastly.net
151.101.193.6 github.global.ssl.fastly.net
```

# 设置

python
```
#! python3
#coding=utf8
```

latex
```
% !TEX encoding = UTF-8
% !TEX program = lualatex
```

OSS
```
权限管理 -> 跨域设置 -> {
    来源: *
    Methods: *
    允许Headers: *
    暴露Headers: x-oss-meta-nls, Etag // 否则分片上传失败
}
```

vscode
```
{ # Ctrl+,
    "editor.renderWhitespace": "boundary",
}
```

# Linux

----------------

## 1. 分区

* 启动网卡

```bash
cd /etc/sysconfig/network-scripts/
vim ifcfg-eth0
ifup eth0
```

```bash
G$ ONBOOT=no ONBOOT=yes
```

* 挂载数据盘

```bash
fdisk -l
fdisk /dev/vdb (n,p,1,,,w)
mkfs.ext4 /dev/vdb1
mkdir -p /var/www/html/zfs
mount /dev/vdb1 /var/www/html/zfs
echo "/dev/vdb1 /var/www/html/zfs ext4 defaults 1 2" >> /etc/fstab
```

* 免密登录（windows）

```bash
ssh-keygen2 -t rsa -b 2048 -P
scp2 C:\Users\<user>\AppData\Roaming\SSH\UserKeys\id_rsa_2048_a.pub root@<ip>:/root/pub
ssh2 root@<ip> "mkdir /root/.ssh && ssh-keygen -i -f /root/pub >> /root/.ssh/authorized_keys"
```

## 2. yum

外网
```bash
wget -O centos7u9-2207v2.iso https://mirrors.bupt.edu.cn/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-Everything-2207-02.iso
```

内网
```bash
mkdir -p /var/www/html/centos/7/os/x86_64
mount -o loop /root/centos7u9-2207v2.iso /var/www/html/centos/7/os/x86_64

rm -rf /etc/yum.repos.d/*
cat>/etc/yum.repos.d/base.repo<EOF
[local]
name=base
baseurl=file:///var/www/html/centos/7/os/x86_64
enable=1
gpgcheck=0
EOF
yum makecache

yum install httpd
```

## 3. 桌面

参照后边添加本地repo

```
yum makecache
yum groupinstall "GNOME Desktop"
startx
```

## 4. xrdp

```bash
外网
wget https://dl.fedoraproject.org/pub/epel/7/x86_64/Packages/i/imlib2-1.4.5-9.el7.x86_64.rpm
wget https://dl.fedoraproject.org/pub/epel/7/x86_64/Packages/x/xrdp-0.9.19-1.el7.x86_64.rpm
```

```bash
内网
sudo rpm -Uvh imlib2 xrdp
sudo vi /etc/xrdp/xrdp.ini
sudo systemctl start xrdp
sudo systemctl enable xrdp
sudo firewall-cmd --permanent --zone=public --add-port=3389/tcp
sudo firewall-cmd --reload
```

计算机 `\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp`

```
// xrdp -k && xrdp-sesman -k
// pgrep -f xrdp | xargs kill -9
// rm -f /var/run/xrdp.pid
```

## 5. docker、compose

* docker + compose
```bash
外网
sudo yum -y install yum-utils
mkdir docker-yum-v20v2 & cd docker-yum-v20v2

yum-config-manager --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
    
repotrack systemd docker-ce docker-ce-cli containerd.io docker-compose-plugin
cd ..
tar -cvf docker-yum-v20v2.tar docker-yum-v20v2/

vim /etc/docker/daemon.json
{ "registry-mirrors": ["https://hub-mirror.c.163.com"] }

python3 -m http.server 80
```

执行 `wget ftp://<localhost>/init.sh`

`install-yum.sh` 内网
```bash
rm -rf /etc/yum.repos.d/*
cat>/etc/yum.repos.d/base.repo<EOF
[local]
name=base
baseurl=http://<ftp>/centos/\$releasever/os/\$basearch
enable=1
gpgcheck=1
gpgkey=http://<ftp>/centos/\$releasever/os/\$basearch/RPM-GPG-KEY-CentOS-\$releasever
EOF
```

`install-docker.sh` 内网
```bash
if [ ! -f docker-yum-v20.tar ]; then
    wget ftp://<ftp>/zfs/docker/docker-yum-v20.tar
fi

tar -xvf docker-yum-v20.tar
yum localinstall docker-yum-v20/*.rpm
systemctl start docker
systemctl enable docker
```

**standalone方式**
注意此时的用法不再是`docker compose`而是`docker-compose`，
容易与v1混淆

```bash
外网
wget https://github.com/docker/compose/releases/download/v2.10.2/docker-compose-linux-x86_64 -O docker-compose
```

```bash
内网
sudo chmod +x docker-compose
mv docker-compose /usr/local/bin/
```

## 6. python3.7

```bash
外网
wget https://www.python.org/ftp/python/3.7.13/Python-3.7.13.tgz
python3 -m http.server 80
```

```bash
内外网
tar -xvf Python-3.7.13.tgz
cd Python-3.7.13
# https://blog.csdn.net/yezhenquan123/article/details/79299989
# 直接编译会少很多模块 _ssl _ctypes _bz2 所以。。。
yum -y install openssl-devel libffi-devel bzip2-devel ncurses-libs sqlite-devel gdbm-devel libdbi-devel readline-devel
yum install gcc-c++
./configure --with-ssl-default-suites=openssl
make
# zlib compress
yum install zlib-devel
make install
```

## 7. dootask

**Prerequisites**: baserepo、docker、compose、git

```bash
cd /opt
git clone --depth=1 https://gitee.com/aipaw/dootask.git
/opt/dootask/cmd install

tar -cvf /opt/datahub-git.tar /opt/datahub/
docker-compose -f /opt/dootask/docker-compose.yml images| awk 'FNR > 1 {print $2":"$3}'| sort -u| xargs docker save -o /opt/dootask-docker.tar
```

---

```bash
cd /opt
wget ftp://<ftp>/linux/docker/superset-docker.tar
wget ftp://<ftp>/linux/docker/superset-git.tar
docker load -i /opt/dootask-docker.tar
tar -xvf /opt/dootask-git.tar
cd dootask # 必须切换目录
./cmd install
./cmd start
```

## 8. jitsi

https://jitsi.github.io/handbook/docs/devops-guide/devops-guide-docker/

https://github.com/jitsi/docker-jitsi-meet/releases/latest

还要修改 `.env`
```
HTTP_PORT 80
HTTPS_PORT 443
PUBLIC_URL=https://xxx.xxx.xxx.xxx/
ENABLE_HTTP_REDIRECT=1
```

为了 RTP media 开放 4443/TCP 和 10000/UDP ?

```bash
wget https://github.com/jitsi/docker-jitsi-meet/archive/refs/tags/stable-7648-4.tar.gz -O /opt/jitsi.tar.gz
tar -xvf /opt/jitsi.tar.gz
mv <dir> jitsi

mkdir -p /opt/jitsi/.jitsi-meet-cfg/{web,transcripts,prosody/config,prosody/prosody-plugins-custom,jicofo,jvb,jigasi,jibri}

cp /opt/jitsi/env.example /opt/jitsi/.env
/opt/jitsi/gen-passwords.sh

docker-compose -p jitsi \
    -f /opt/jitsi/docker-compose.yml \
    -f /opt/jitsi/etherpad.yml up

tar -cvf /opt/jitsi-git.tar /opt/jitsi/
docker-compose -p jitsi images| awk 'FNR > 1 {print $2":"$3}'| sort -u| xargs docker save -o /opt/jitsi-docker.tar
```

---

```bash
cd /opt
wget ftp://<ftp>/linux/docker/jitsi-docker.tar
wget ftp://<ftp>/linux/docker/jitsi-git.tar
docker load -i /opt/jitsi-docker.tar
tar -xvf /opt/jitsi-git.tar
vi .env @ HTTP_PORT=80 HTTPS_PORT=443 TZ=Asia/Shangha ENABLE_HTTP_RECIRECT=1
docker-compose \
    -f /opt/jitsi/docker-compose.yml \
    -f /opt/jitsi/etherpad.yml up
```

## 9. datahub

**Prerequisites**: baserepo、docker、compose、git

https://datahubproject.io/docs/quickstart

```bash
cd /opt
git clone https://github.com/datahub-project/datahub.git

# https://blog.csdn.net/qq_44033208/article/details/125329536
# datahub docker quickstart
# source /opt/datahub/docker/quickstart.sh
DOCKER_DEFAUTL_PLATFORM=x86_64 docker-compose -p datahub -f /opt/datahub/docker/quickstart/docker-compose-without-neo4j.quickstart.yml up

# https://datahubproject.io/docs/docker#ingesting-demo-data
# datahub docker ingest-sample-data
# source /opt/datahub/docker/ingestion/ingestion.sh
docker-compose -p datahub -f /opt/datahub/docker/ingestion/docker-compose.yml up

tar -cvf /opt/datahub-git.tar /opt/datahub/
docker-compose -p datahub images| awk 'FNR > 1 {print $2":"$3}'| sort -u| xargs docker save -o /opt/datahub-docker.tar
```

```bash
# 停止
datahub docker quickstart --stop
# 复原
datahub docker nuke
# 备份
datahub docker quickstart --backup --backup-file /root/bak0917.sql
# 中国区
datahub docker quickstart --quickstart-compose-file ./docker/quickstart/docker-compose-without-neo4j.quickstart.yml
```

---

```bash
cd /opt
wget ftp://<ftp>/linux/docker/datahub-docker.tar
wget ftp://<ftp>/linux/docker/datahub-git.tar
docker load -i /opt/datahub-docker.tar
tar -xvf /opt/datahub-git.tar

export DATAHUB_MAPPED_FRONTEND_PORT=80
DOCKER_DEFAULT_PLATFORM=x86_64 \
    docker-compose -p datahub \
    -f /opt/datahub/docker/quickstart/docker-compose-without-neo4j.quickstart.yml up

docker-compose -p datahub \
    -f /opt/datahub/docker/ingestion/docker-compose.yml up
```

## 10. Amundsen

```bash
外网
git clone --recursive https://github.com/amundsen-io/amundsen.git
cd /root/amundsen/databuilder
python3.7 -m pip download --trusted-host mirrors.cloud.aliyuncs.com -d vendor setuptools
python3.7 -m pip download --trusted-host mirrors.cloud.aliyuncs.com -d vendor -r requirements.txt

tar -cvf amundsen-git.tar amundsen/
docker-compose -f docker-amundsen.yml up
docker-compose -f docker-amundsen.yml images| awk 'FNR > 1 {print $2":"$3}'| sort -u| xargs docker save -o ../amundsen-docker-images.tar
```

---

```bash
cd /opt
wget ftp://<ftp>/linux/docker/amundsen-docker.tar
wget ftp://<ftp>/linux/docker/amundsen-git.tar
docker load -i amundsen-docker.tar
tar -xvf amundsen-git.tar
cd /opt/amundsen/
cp docker-amundsen.yml du.yml
vi du.yml @ 5000:5000 -> 80:5000
docker-compose -f du.yml up

cd amundsen/databuilder
python3.7 -m venv venv
source venv/bin/activate
pip install vendor/*.tar.gz
pip install vendor/*.whl
python setup.py install
python example/scripts/sample_data_loader.py
deactivate
```

## 11. Superset

```bash
git clone https://github.com/apache/superset.git
tar -cvf superset-git.tar superset/
docker-compose -f docker-compose-non-dev.yml up
docker-compose -f docker-compose-non-dev.yml images| awk 'FNR > 1 {print $2":"$3}'| sort -u| xargs docker save -o ../superset-docker-images.tar
```

---

```bash
cd /opt
wget ftp://<ftp>/linux/docker/superset-docker.tar
wget ftp://<ftp>/linux/docker/superset-git.tar
docker load -i superset-docker.tar
tar -xvf superset-git.tar
cd /opt/superset/
cp docker-compose-non-dev.yml du.yml
vi du.yml @ 8088:8088 -> 80:8088
docker-compose -f du.yml up
```

## 12. zfile

```bash
wget https://c.jun6.net/ZFILE/zfile-release.war
unzip zfile-release.war -d /opt/zfile
cat /opt/zfile/WEB-INF/classes/application.properties
chmod +x $ZFILE_INSTALL_PATH/bin/*.sh
/opt/zfile/bin/start.sh
```

## 12+. onlyoffice

https://helpcenter.onlyoffice.com/installation/docs-community-docker-compose.aspx

```bash
git clone https://github.com/ONLYOFFICE/Docker-DocumentServer
tar -cvf zfile-office-git.tar
```

`du.yml`
```yml
version: '3'
services:
  onlyoffice:
    container_name: onlyoffice
    image: onlyoffice/documentserver
    restart: always
    ports:
      - "80:80"
      - "443:443"
    environment:
      - JWT_ENABLED=false
    volumes:
      - '$PWD/v/logs:/var/log/onlyoffice'
      - '$PWD/v/data:/var/www/onlyoffice/Data'
      - '$PWD/v/lib:/var/lib/onlyoffice'
      - '$PWD/v/db:/var/lib/postgresql'
```

```bash
docker-compose -f du.yml pull
docker-compose -p oo -f du.yml up
docker-compose -p oo images| awk 'FNR > 1 {print $2":"$3}'| sort -u| xargs docker save -o /opt/zfile-office-docker.tar
```

---

```bash
zfile-office-ssl.md

docker load -i zfile-office-docker.tar
cd opt && tar -xvf zfile-office-git.tar
docker compose -p oo -f du.yml up

openssl genrsa -out tls.key 2048
openssl req -new -key tls.key -out tls.csr
openssl x509 -req -days 365 \
    -in tls.csr -signkey tls.key -out tls.crt
openssl dhparam -out dhparam.pem 2048

# csr 不是必须的但要备份
mkdir -p $PWD/data/certs
cp tls.key tls.crt dhparam.pem into $PWD/data/certs
chmod 400 tls.key
```

## 13. overleaf

https://github.com/overleaf/toolkit/blob/master/doc/quick-start-guide.md

```bash
git clone https://github.com/overleaf/toolkit.git /opt/overleaf-toolkit
tar -cvf overleaf-git.tar overleaf-toolkit

bin/init
vi bin/docker-compose 去掉横杠
vi config/overleaf.rc 改为0.0.0.0
bin/up
bin/up > 1 &

docker compose ls -a # project_name=overleaf
docker compose -p overleaf images| awk 'FNR > 1 {print $2":"$3}'| sort -u| xargs docker save -o /opt/overleaf-docker.tar

# https://zhuanlan.zhihu.com/p/432741178
docker exec sharelatex tlmgr update --self
docker exec sharelatex tlmgr option repository http://mirrors.ustc.edu.cn/CTAN/systems/texlive/tlnet/
docker exec sharelatex tlmgr install scheme-full
docker commit sharelatex sharelatex/sharelatex:with-texlive-full
docker image ls
docker save -o /opt/overleaf-texlive-docker.tar sharelatex/sharelatex:with-texlive-full
```

---

```bash
docker load -i overleaf-docker.tar
docker load -i overleaf-texlive-docker.tar
docker images
docker rmi sharelatex/sharelatex:3.2.2
docker tag sharelatex/sharelatex:with-texlive-full sharelatex/sharelatex:3.2.2
docker rmi sharelatex/sharelatex:with-texlive-full

cd opt && tar -xvf overleaf-git.tar
vi config/version : 3.22 -> with-texlive-full
cd toolkit && bin/up
```

访问 `<url>/launchpad` 注册管理员用户
`kpsewhich -a texmf.cnf`
`kpsewhich -var-value=TEXMFHOME`
`mkfontdir` 安装字体
`fc-cache -fv` 刷新字体缓存

# ww

## yum

```
rpm -ivh /var/ftp/pub/centos7u2/deltarpm-*
rpm -ivh /var/ftp/pub/centos7u2/python-deltarpm-*
rpm -ivh /var/ftp/pub/centos7u2/createrepo-*
createrepo -g /var/ftp/pub/centos7u2/repodata/repomd.xml /var/ftp/pub/centos7u2/
```

启动+防火墙
```
systemctl start vsftpd
☆ systemctl enable vsftpd

firewall-cmd --list-services
firewall-cmd --get-services |grep ftp
firewall-cmd --permanent --add-service ftp
firewall-cmd --reload
```


## pypi

```
外网
python3 -m pip download -d vendor3 -r requirements3.txt -i http://pypi.douban.com/simple --trusted-host pypi.douban.com --no-binary=:all: --only-binary=django-auth-ldap,eventlet

内网
pip install pypiserver-* meld-* supervisor-*
```

```bash
mkdir ~/run
echo_supervisord_conf > /etc/supervisord.conf
vim /etc/supervisord.conf
```

```
[unix_http_server]
file=/root/run/supervisord.sock
[supervisorctl]
serverurl=unix:///root/run/supervisord.sock
[program:pypi]
command=pypi-server /var/pypi -p 8080
```

```bash
supervisord
firewall-cmd --permanent --add-port 8080/tcp
firewall-cmd --reload
```

## nginx

```
yum install pcre-devel openssl-devel zlib-devel
```

```
wget ftp://11.33.128.10/linux-packages/nginx-1.8.1.tar.gz
yum install gcc
tar -zxvf nginx-*
cd nginx-*
./configure
make
make install
```

```
vim /usr/local/nginx/conf/nginx.conf
```

```
location / {
  include uwsgi_params;
  uwsgi_pass 127.0.0.1:9000;
  client_max_body_size 10m;
  ...
}
```

```
ln -s /usr/local/lib/libpcre.so.1 /lib64
```

* 安装uwsgi

```
yum install python-devel
pip install uwsgi importlib
```

* 安装supervisor

```
pip install supervisor
```

* 配置supervisor

```
mkdir ~/run
echo_supervisord_conf > /etc/supervisord.conf
vim /etc/supervisord.conf
```

```
[unix_http_server]
file=/root/run/supervisord.sock
[supervisorctl]
serverurl=unix:///root/run/supervisord.sock
```

`G` `$` `a`

```
[program:nginx]
command=/usr/local/nginx/sbin/nginx -g "daemon off;"
[program:uwsgi]
command=uwsgi -s :9000 -w app:application --chdir /root/www/v1 --processes 1 --threads 2
```

* 配置防火墙

```
firewall-cmd --list-ports
firewall-cmd --zone=public --permanent --add-port 80/tcp
firewall-cmd --zone=public --permanent --add-port 8080/tcp
firewall-cmd --reload
```

# 附录：常见命令

* 分割文件 `split BIG* -b 600m -d BIGFILE.iso.`
* 杀掉进程 `pgrep -f nginx | xargs kill -9` 
* 复制文件 `copy -af src dst`
* 查看端口 `netstat -ntl`
* 查看进程 `ps -ef | grep nginx`
* 杀掉进程 `killall nginx`
* 启动应用 `supervisorctl start all`
* 查看应用 `supervisorctl status`
* 查看监听 `lsof -i:5000`
* 复制FTP `wget -m -nH {url}`
* 查看VNC `vncserver -list`
* 杀掉VNC `vncserver -kill :1`
* 杀掉RDP `xrdp -k && xrdp-sesman -k`
* 杀掉MNT `fuser -m -k /mnt/xvdb`

# 附录：docker

* 启动服务
`sudo systemctl start docker`

* 查找镜像
`sudo docker search nginx`

* 下载镜像
`sudo docker pull nginx`
    
* 查看镜像
`sudo docker images`

* 运行容器
`mkdir -p nginx/{www,logs,conf}`
`sudo docker run -d -p 80:80 -v $PWD/www:/www -v $PWD/conf/nginx.conf:/etc/nginx/nginx.conf -v $PWD/logs:/wwwlogs --name mynginx nginx`
    
* 查看容器
`sudo docker ps -a`

* 删除镜像
`sudo docker rmi nginx`

* 删除
```
sudo docker stop $(sudo docker ps -qa --filter name=mynginx)
sudo docker rm   $(sudo docker ps -qa --filter name=mynginx)
sudo docker rmi  $(sudo docker image ls -q)
```

* 导出导入原版镜像
```
sudo docker export $(sudo docker ps -qa --filter name=mynginx) > /home/export.tar
sudo docker import /home/export.tar nginx-export:latest
```

* 保存装载整个镜像（持久化）
```
sudo docker save nginx > /home/save.tar
sudo docker load < /home/save.tar
```

# opencv

    wget https://github.com/opencv/opencv/archive/3.2.0.zip

    sudo pip install python-devel numpy

    sudo dnf install gcc gcc-c++ cmake-gui

    sudo dnf install atlas blas lapack

    sudo dnf install tbb-devel eigen3-devel

    sudo dnf install gtk3-devel libv4l-devel libdc1394-devel
    
    cmake -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/local \
    -D BUILD_PYTHON_SUPPORT=ON -D WITH_TBB=ON -D WITH_EIGEN=ON -D WITH_V4L=ON .
    
    make && sudo make install

    g++ `pkg-config --cflags opencv` -o test test.cpp `pkg-config --libs opencv`
